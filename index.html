<!DOCTYPE html>
<html>
    
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Prototype</title>
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
        <meta name="description" content="An interactive getting started guide for Brackets.">
        <meta name="apple-mobile-web-app-capable" content="yes">
        
        <!-- Bootstrap Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
        
        <link rel="stylesheet" href="stylesheets/reset.css">
        <link rel="stylesheet" href="stylesheets/sass/main.css">
        <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:300' rel='stylesheet' type='text/css'>
        
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script type="text/javascript" src="mustache.js-master/mustache.js" ></script>
        <script type="text/javascript" src="jquery.ba-throttle-debounce.min.js"></script>
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        
    </head>
    <body>
        <div id="container">
            <div id="animation">
            <div class='logo'>
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" width="762px" height="349px" viewBox="0 0 762 349" enable-background="new 0 0 762 349" xml:space="preserve">
                <g>
                    <path d="M708.277 247.84c-6.031-21.928-14.803-78.94-14.803-91.001c0-5.722-2.742-35.084-6.029-66.332 c-3.607-34.229-7.676-70.495-7.676-75.104c0-8.771-18.545-16.104-21.928-15.35c-4.934 1.096-8.223 118.411-9.32 140.3 c-1.096 21.929-11.512 106.352-18.09 124.991s-18.092 65.783-37.826 60.85c-21.928-5.48-14.801-163.912-18.09-172.683 s-23.881-30.683-23.025 10.965c1.473 71.625-32.883 133.761-34.871 134.531c-1.301-0.41-19.289-127.953-30.912-127.953 c-35.703 0-86.616 111.833-89.906 121.152c-10.416 1.645-8.771-172.683-9.867-178.166c-1.097-5.482-13.157-12.061-17.543-12.061 s-52.388 204.273-61.398 205.027c-13.156 1.098-17.542-115.121-28.506-166.653c-1.953-9.165-11.685-12.745-15.351-12.06 c-17.542 3.289-51.531 163.365-58.109 164.46s-6.578-13.158-16.445-54.82c-9.868-41.664-32.892-57.014-53.724-57.014 C114.026 181 1.1 253.3 0 259.9c0 0 2.2 12.1 9.9 12.061s97.58-74.555 132.665-76.748 c35.084-2.193 31.8 140.3 55.9 141.436c24.121 1.1 54.82-154.592 62.495-154.592s18.639 92.1 20.8 117.3 c2.193 25.2 9.9 41 26.3 39.471c23.025-2.193 46.05-149.111 52.628-150.207c6.579-1.098 10.4 71.3 14.8 97.6 c4.385 26.3 7.4 43.8 10.4 52.078c5.481 15.3 19.9 13.6 23.023-4.934c11.513-67.428 58.109-129.375 72.363-129.375 c4.387 0 13.3 70.6 19 113.666c1.986 14.9 18.1 8.8 23.5 1.027c6.434-9.268 28.928-51.104 32.08-51.104 c4.385 0 9.4 41.4 16.4 62.496c9.867 29.6 34 16.4 36.7 14.254c18.836-15.061 31.246-65.783 36.729-91.002 c5.268-24.223 13.156-167.75 15.896-167.201c3.273 0.7 23.6 188 52.1 239.562c13.055 23.6 24.3 8 23 4.4 C733.492 320.8 714.2 269.2 708.3 247.84z"/>
                    <path d="M533.947 26.367c-6.938 0-9.867 8.771-2.191 16.446c7.674 7.7 25.2 11 30.7 6.6 c5.48-4.386 10.963-8.771 5.48-17.542C562.455 23.1 538.3 26.4 533.9 26.367z"/>
                    <path d="M754.324 136.555c3.838 1.1 7.7 9.7 7.7 13.705c0 4.386-40.566 31.796-61.398 36.2 c-20.832 4.387-47.146 6.029-48.242 0.547c-1.096-5.48-1.645-19.185 7.127-19.185c20.857 0 44.404-2.193 55.369-8.771 C725.818 152.5 754.3 136.6 754.3 136.555z"/>
                </g>
                </svg>
            </div>
           <div id="search">
               <form id='search-form'>
                   <input type="search" class="form-control" id="search-title" placeholder="Search"/>
                   <span class="glyphicon glyphicon-search form-control-feedback"></span>
               </form>
               
               <ul id="list">
               </ul>
            </div>
                </div>
            
            <div id="display-results"></div>
            
            <div id="display-works"></div>
            
            <div id="loader"></div>
        </div>
        
        <script id="template" type="text/html">
            {{#results}} 
                <li data-media-type="{{media_type}}" data-id="{{id}}"><p>{{title}}</p></li>
            {{/results}}
            
            {{#cast}}
                <div data-id="{{id}}" class="main">
                    <div class="profile-pic">
                        <img class='img-link' src='https://image.tmdb.org/t/p/w92{{profile_path}}' />
                    </div>
                    <p class="info">
                        {{name}} plays <span class="character">{{character}}</span>
                    </p>
                </div>
            {{/cast}}
        </script>
        
        <script id="template-works" type="text/html">
            {{#cast}}
             <div data-id="{{id}}" class="works">
                    <div>
                        <img src='https://image.tmdb.org/t/p/w92{{poster_path}}' />
                    </div>
                    <!--<p class="info">
                        <span>{{title}} {{release_date}}</span>
                        <span>{{name}} {{episode_count}} {{first_air_date}}</span>
                    </p>-->
                </div>    
            {{/cast}}
        </script>
            
            
        
        <script>
            var loader = '<img src="loader.gif" />';
            var listItemTemplate = $('#template').html();
            var workItemTemplate = $('#template-works').html();
            
            function listResults(data) {
               console.log(data);
                
                normalizeData(data);
                var output = Mustache.render(listItemTemplate, data);
                
                console.log(output);
                
                var $list = $('#list');
                $list.empty();
                $list.append(output);
            };
            
            function normalizeData(data) {
                for ( var i = 0, len = data.results.length; i < len; ++i ) {
                  if ( data.results[i].media_type == 'tv' ) {
                    data.results[i].title = data.results[i].name;
                  }
                }
            };
                        
            function loadingBar() {
                $('#loader').append(loader);
            };
            
            function hideLoadingBar() {
                $('#loader').empty();
            }

            function search(title) {
                loadingBar();
                
                var queryArgs = { 
                    api_key: '21002876c9ca37eae9f1970c0bc7ecb0',
                    query: title
                };

                $.ajax({
                    method: 'GET',
                    url: 'http://api.themoviedb.org/3/search/multi',
                    data: queryArgs,
                    success: listResults,
                    complete: hideLoadingBar
                });
            };
            
            function getActors(mediaType, id) {
                // ... follow pattern of search ...
                loadingBar();
                
                var URL = 'http://api.themoviedb.org/3/' + mediaType + '/' + id + '/credits';
                console.log(URL);
                
                var queryArgs = { 
                    api_key: '21002876c9ca37eae9f1970c0bc7ecb0'
                };
                
                $.ajax({
                    method: 'GET',
                    url: URL,
                    data: queryArgs,
                    success: displayActors,
                    complete: hideLoadingBar
                });
            }
            
            $('#search-title').on('keyup', $.debounce( 250, function() {
              search($('#search-title').val());
            } ));
            
            $('#search-title').on('focus', function(e) {
                e.preventDefault();
                $(this).select();
            });
            
            $('#search-form').submit(function(e) {
                e.preventDefault();
                search($('#search-title').val());
            });
            
            $('#list').on('click', 'li', function(e) {
                e.preventDefault();
                var searchText = $(this).text();
                $('#search-title').val( searchText );
                
                var $works = $('#display-works');
                var $cast = $('#display-results');
                
                $works.children().remove();
                $cast.children().remove();
            });
            
            function displayActors(results) {
                console.log(results);
                
                var output = Mustache.render(listItemTemplate, results);
                
                console.log(output);
                
                var $cast = $('#display-results');
                $cast.empty();
                $cast.append(output);
                
                //Replacing missing images with a background color
                var URL = 'https://image.tmdb.org/t/p/w92';
                var image = $cast.find('img');
                console.log(image);
                
                $(image).each(function() {
                    var src = $(this).attr('src');
                    if ( src === URL ) {
                        $(this).parent().addClass('null');
                        $(this).remove();
                    }
                });
            }
         
            $('ul').on('click', 'li', function(e) {
                e.preventDefault();

                //var result = '<p>This is your result</p>';
                //$("#display-results").append(result);

                var mediaType = $(this).data('media-type');
                var id = $(this).data('id');
                console.log(mediaType, id);

                getActors(mediaType, id);

                var $list = $('#list');
                $list.empty();
                
                var $body = $('body');
                $body.addClass('actor-list');
                
                var $top = $('#animation');
                $top.css('top', '-80px');
            });  
            
            function getWorks(id) {
                // ... follow pattern of search ...
                loadingBar();

                var queryArgs = { 
                    api_key: '21002876c9ca37eae9f1970c0bc7ecb0'
                };

                var movieUrl = 'http://api.themoviedb.org/3/person/' + id + '/movie_credits';
                var movieDeferred = $.ajax({
                    method: 'GET',
                    url: movieUrl,
                    data: queryArgs
                });
                
                var tvUrl = 'http://api.themoviedb.org/3/person/' + id + '/tv_credits';
                var tvDeferred = $.ajax({
                    method: 'GET',
                    url: tvUrl,
                    data: queryArgs,
                });
                
                $.when(movieDeferred, tvDeferred).then(
                  function(movieData, tvData) {
                    var movieWorks = movieData[0];
                    var tvWorks = tvData[0];
                      
                    displayWorks(movieWorks, tvWorks);
                    hideLoadingBar();
                  },
                  hideLoadingBar);
            }
            
            function displayWorks(movieWorks, tvWorks) {
                console.log('movieWorks', movieWorks);
                console.log('tvWorks', tvWorks);
                
                var movieOutput = Mustache.render(workItemTemplate, movieWorks);
                var tvOutput = Mustache.render(workItemTemplate, tvWorks);
                
                console.log('movieOutput', movieOutput);
                console.log('tvOutput', tvOutput);
                
                var $works = $('#display-works');
                $works.empty();
                $works.append(movieOutput);
                $works.append(tvOutput);
                
                //Replacing missing images with a background color
                var URL = 'https://image.tmdb.org/t/p/w92';
                var image = $works.find('img');
                console.log(image);
                
                $(image).each(function() {
                    var src = $(this).attr('src');
                    if ( src === URL ) {
                        $(this).parent().addClass('null');
                        $(this).remove();
                    }
                });
            }
            
            $('#display-results').on('click', 'div', function(e) {
                e.preventDefault();

                var result = '<p>This is your result</p>';
                $("#display-works").append(result);
                
                var id = $(this).data('id');
                console.log(id);

                getWorks(id);

                var $list = $('#display-results');
                $list.empty();
            });  
        
        </script>
    </body>
</html>